name: Genesis - Initialize Evolution

on:
  workflow_dispatch:  # Manual trigger only

jobs:
  genesis:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: main
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Configure Git
        run: |
          git config user.name "Hash Chain Bot"
          git config user.email "hashchain@evolution.bot"
      
      - name: Create Genesis Block
        run: |
          echo "# Hash Chain Evolver - Genesis Block" > GENESIS.md
          echo "" >> GENESIS.md
          echo "**Created:** $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> GENESIS.md
          echo "**Purpose:** Autonomous cryptographic evolution" >> GENESIS.md
          echo "" >> GENESIS.md
          echo "This repository evolves based on commit hash values." >> GENESIS.md
          echo "No human intervention required after genesis." >> GENESIS.md
          
          mkdir -p features docs
          
          # Initialize state
          echo '{"features_created": 0, "features_deleted": 0, "refactors": 0}' > state.json
          echo '{"features_created": 0, "features_deleted": 0, "refactors": 0}' > docs/state.json
          
          # Initialize log
          cat > EVOLUTION_LOG.md << 'EOF'
          # Hash Chain Evolution Log

          This log tracks every autonomous evolution step.

          ---
          EOF
          
          cp EVOLUTION_LOG.md docs/EVOLUTION_LOG.md
      
      - name: Initialize README
        run: |
          cat > README.md << 'EOF'
          # Hash Chain Evolver

          A self-evolving repository driven by cryptographic determinism.

          ## Status

          ðŸŒ± **Genesis phase complete**

          Autonomous evolution will begin with the next scheduled run.

          ## How It Works

          Each commit's SHA-256 hash deterministically controls the next evolution step.

          See [EVOLUTION_LOG.md](EVOLUTION_LOG.md) for the full evolution history.

          ---

          *No human intervention required. The chain evolves itself.*
          EOF
      
      - name: Commit Genesis
        run: |
          git add .
          git commit -m "Genesis: Initialize hash chain evolution"
          git push
      
      - name: Display Genesis Hash
        run: |
          GENESIS_HASH=$(git rev-parse HEAD)
          echo "ðŸŽ‰ Genesis Complete!"
          echo "Genesis Hash: $GENESIS_HASH"
          echo "Hash Value: $((16#${GENESIS_HASH: -2}))"
          echo ""
          echo "Evolution will begin automatically according to schedule."
